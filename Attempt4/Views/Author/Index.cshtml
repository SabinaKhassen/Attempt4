@{
    ViewBag.Title = "Index";
}

@*@Html.ActionLink("Create author", "Edit")*@

@Html.Partial("Partial/_MyPartialView", @ViewBag.AuthorsTop as List<Attempt4.ViewModels.AuthorViewModel>)

<h2>Authors</h2>

<p>
    <a id="link" onclick="EditView()">Create author</a>
</p>

<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-sm">Create author</button>

<div id="modal" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div id="createOrEdit" class="modal-content">
            @Html.Partial("Partial/EditPartialView", new Attempt4.ViewModels.AuthorViewModel())
        </div>
    </div>
</div>

<div id="authorList">
    @Html.Partial("Partial/AuthorPartialView", ViewBag.Authors as List<Attempt4.ViewModels.AuthorViewModel>)
</div>

<a onclick="Refresh()">Refresh</a>
<script type="text/javascript">
    function Refresh() {
        $.ajax({
            url: '@Url.Action("Index")',
            method: "GET",
            success: function (data) {
                $("#authorList").html(data);
            }
        });
    }

    function EditView() {
        $.ajax({
            url: '@Url.Action("Edit")',
            method: 'GET',
            success: function (data) {
                $("#createOrEdit").html(data);
            }
        })
    }

    function SaveEdit() {
        console.log("save edit")
        var id = $("#Id").val();
        var firstName = $("#FirstName").val();
        var lastName = $("#LastName").val();
        console.log(id)
        console.log(firstName)
        console.log(lastName)
        $.ajax({
            url: '@Url.Action("Edit")',
            method: 'POST',
            data: JSON.stringify({ Id: id, FirstName: firstName, LastName: lastName }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#modal').modal('hide');
                $("#authorList").html(data);
            }
        })
    }
</script>